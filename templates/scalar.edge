<!DOCTYPE html>
<html lang="en">
    <head>
        <title>
            {{ title }} - API Documentation
        </title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="{{ description || 'API Documentation' }}" />
        <style>
            body {
                margin: 0;
                padding: 0;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            }
            
            #scalar-container {
                height: 100vh;
                width: 100%;
            }
            
            /* Custom scrollbar */
            
            ::-webkit-scrollbar {
                width: 8px;
            }
            
            ::-webkit-scrollbar-track {
                background: #f1f1f1;
            }
            
            ::-webkit-scrollbar-thumb {
                background: #c1c1c1;
                border-radius: 4px;
            }
            
            ::-webkit-scrollbar-thumb:hover {
                background: #a8a8a8;
            }
            
            /* Dark mode scrollbar */
            
            @media (prefers-color-scheme: dark) {
                ::-webkit-scrollbar-track {
                    background: #2d2d2d;
                }
            
                ::-webkit-scrollbar-thumb {
                    background: #555;
                }
            
                ::-webkit-scrollbar-thumb:hover {
                    background: #777;
                }
            }
            
            @if(customCss)
                    {{{ customCss }}}
                @end
        </style>
    </head>
    <body>
        <!-- Scalar API Reference Container -->
        <div id="scalar-container">
        </div>

        <!-- Load Scalar API Reference -->
        <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference@latest">

        </script>

        <!-- Initialize Scalar -->
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Ensure Scalar is loaded
                if (typeof window.Scalar === "undefined" || !window.Scalar.createApiReference) {
                    console.error("Scalar API Reference library failed to load");
                    return;
                }
                try {
                    // Build configuration object
                    const config = {
                        // OpenAPI document URL
                        spec: {
                            url: "{{ specUrl }}"
                        },
                        // Theme configuration
                        @if(theme === 'auto')
                            theme: window.matchMedia('(prefers-color-scheme: dark)').matches ? "moon" : "default",
                        @else
                            theme: "{{ theme || 'default' }}",
                        @end

                        // Layout and UI options
                        layout: "{{ layout || 'modern' }}",
                        showSidebar: {{ showSidebar !== false ? 'true' : 'false' }},
                        searchHotKey: "{{ searchHotKey }}",

                        // New configuration options
                        darkMode: {{ darkMode ? 'true' : 'false' }},
                        hideDarkModeToggle: {{ hideDarkModeToggle ? 'true' : 'false' }},
                        hideTestRequestButton: {{ hideTestRequestButton ? 'true' : 'false' }},
                        hideModels: {{ hideModels ? 'true' : 'false' }},
                        hideSearch: {{ hideSearch ? 'true' : 'false' }},
                        persistAuth: {{ persistAuth ? 'true' : 'false' }},
                        hideDownloadButton: false,

                        // Conditional proxy URL
                        @if(proxyUrl)
                            proxyUrl: "{{ proxyUrl }}",
                        @end

                        // Custom fetch function for credentials (cookie auth support)
                        @if(withCredentials)
                            fetch: (url, options) => {
                                return fetch(url, {
                                    ...options,
                                    credentials: 'include'
                                });
                            },
                        @end

                        // Metadata
                        metaData: {
                            title: "{{ title }}",
                            description: "{{ description || 'API Documentation' }}"
                        }
                    };

                    // Merge additional configuration (typed options take precedence)
                    const additionalConfig = {{{ JSON.stringify(additionalConfig) }}};
                    const finalConfig = { ...additionalConfig, ...config };

                    // Initialize Scalar API Reference
                    window.Scalar.createApiReference("#scalar-container", finalConfig);
                } catch (error) {
                    console.error("Failed to initialize Scalar API Reference:", error);
                }
            });
        </script>
    </body>
</html>
